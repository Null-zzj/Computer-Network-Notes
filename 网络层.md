# 网络层

## 网络层概述

- 网络层的主要任务是**实现网络互联**，进而**实现数据包在网络间之间的传输**
- 要实现网络层的任务，则需要解决一下主要问题
  - 网络层向运输层提供怎样的服务（**可靠传输**还是**不可靠传输**）
  - 网络层寻址问题
  - 路由选择问题
- 因特网（internet）是目前全世界用户数量最多的互联网，它使用**TCP/IP**协议栈
- 由于**TCP/IP**协议栈的网络层使用**网际协议IP**，它是整个协议栈的核心协议，因此在TCP/IP协议栈中网络层通常被称为**网际层**

## 网络层提供的两种服务

### 面向连接的虚电路服务

- **可靠通信由网络来保证**
- 必须建立**网络层的连接---虚电路VC**（Virtual Circuit） 
- 通信双方**沿着已建立的虚电路发送分组**

### 无连接的数据报服务

- **可靠通信有主机来保证**
- **不需要建立网络层连接**
- **每个分组可走不同路径**
- 每个分组的**首部必须携带目的主机的完整地址**
- 这种通信方式所传送的**分组可能误码，丢失，重复和时序**

### 网络层的两个层面

在路由器之间传送的信息有一下两大类：

- 转发源主机和目的主机之间所传送的**数据**
- **传送路由信息** （是根据路由算法导出为转发分组而用的转发表）

因此，网络层可抽象为**数据层面**和**控制层面**

## 网际协议 IP

### IP地址

#### 概述

- **IPv4地址**就是给英特网上的**每一台主机（或路由器）的每一个接口**分配一个在全世界范围内是一个**唯一的32比特的标识符**
- IP地址由英特网名字和数字分配机构**ICANN**进行分配
- IPv4地址使用**点分10进制表示方法**以方便用户使用

#### 分类的IP地址

- A类地址

  ![A类地址](images.assets/A类地址.png)

  最小网络号0，保留不指派

  第一个可指派的网络号为1，网络地址为 1.0.0.0

  最大网络号为 127，作为本地回环测试，不指派

  范围 0 - 127， 可指派的网络数量 = 2^(8-1) - 2 = 126
 
- B类地址

  ![B类地址](images.assets/B类地址.png)

  最小网络号为128.0，其网络地址为128.0.0.0

  最大网络号也是最后一个可指派网络号为191.255， 其网络地址为191.255.0.0

  可分配范围 128 - 191， 可指派网络数量 = 2^(16-2)

- C类地址

  ![C类地址](images.assets/C类地址.png)
  最小网络号192.0.0，其网络地址为 192.0.0.0

  最大网络号也是最后一个可指派网络号为223.255.255，其网络地址为223.255.255.0

  可分配范围 192 - 223, 可指派的网络地址数量 = 2^(24 - 3 )

- D类地址

  多播地址，该地址前缀为1110

  可分配范围 224 - 239

- E类地址

  保留地址，该地址前缀为1111
  
  不可被分配， 范围 240 - 255